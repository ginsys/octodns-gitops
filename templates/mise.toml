# octodns-gitops mise configuration template
# Copy this file to your dns-zones repository

[tools]
python = "3.12"

[env]
_.python.venv = { path = "pyvenv", create = true }

# Update this to change octodns-gitops version
# Use a commit hash or tag (e.g., "v0.1.0" or "abc123")
OCTODNS_GITOPS_VERSION = "main"

[tasks.setup]
description = "Install dependencies and generate Makefile or update all"
run = """

echo "# update python code"
rm -rf {{config_root}}/pyvenv {{config_root}}/Makefile
python -m venv {{config_root}}/pyvenv
pip install --upgrade pip
pip install "octodns-gitops @ git+https://github.com/ginsys/octodns-gitops@${OCTODNS_GITOPS_VERSION}"

echo "# update Makefile"
octodns-gitops-init | tee {{config_root}}/Makefile

echo "# update mise.toml"
curl https://raw.githubusercontent.com/ginsys/octodns-gitops/main/templates/mise.toml | tee {{config_root}}/mise.toml
mise trust

"""
